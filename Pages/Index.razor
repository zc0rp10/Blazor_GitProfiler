@page "/"
@inject HttpClient Http

<main>
    @if (_githubUser.login != null)
    {

        <UserInfo UserData="_githubUser" />
        @* <UserCharts /> *@
        <UserRepos ReposData="_githubUserRepos" />
        <Footer />
    }
    else
    {
        <UserForm OnSubmit="SubmitHandler" />
    }
</main>

@code {
    GithubUser _githubUser = new GithubUser();
    List<GithubRepo> _githubUserRepos = new List<GithubRepo>();

    //TODO: Remove OnInitializedAsync() at end of project. Temp functions so you don't have to enter a user every time.
    protected override async Task OnInitializedAsync()
    {
        var tempUserJson = await Http.GetStringAsync($"https://api.github.com/users/bchiang7");
        _githubUser = JsonConvert.DeserializeObject<GithubUser>(tempUserJson);

        var tempRepoJson = await Http.GetStringAsync($"https://api.github.com/users/bchiang7/repos");
        _githubUserRepos = JsonConvert.DeserializeObject<List<GithubRepo>>(tempRepoJson);
    }

    private async Task SubmitHandler(string inputUserName)
    {
        try
        {
            var rawJsonString = await Http.GetStringAsync($"https://api.github.com/users/{inputUserName}");
            _githubUser = JsonConvert.DeserializeObject<GithubUser>(rawJsonString);
        }
        catch (Exception e)
        {
            System.Console.WriteLine(e.Message);
        }
    }
}
